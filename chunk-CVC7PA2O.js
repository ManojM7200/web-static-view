import{Tb as d,U as p,ya as h}from"./chunk-MBWBBTNW.js";import{ka as l,pa as n}from"./chunk-7JLUKY3W.js";var m=class c{constructor(t,e,r){this.router=t;this.reactNativeCommunicator=e;this.toast=r}DEEP_LINK_SCHEME="onestage://";WEB_BASE_URL="https://one-town-app.netlify.app";generateDeepLink(t,e){return`${this.DEEP_LINK_SCHEME}customers/info?providerId=${t}`}generateWebUrl(t){let e=window.location.origin,r=/^(https?:\/\/)?(10\.|172\.(1[6-9]|2[0-9]|3[01])\.|192\.168\.|127\.0\.0\.1|localhost)/.test(e),i=e.includes("localhost")||e.includes("127.0.0.1"),o=e.startsWith("file://"),a=e;return(o||i||r)&&(this.WEB_BASE_URL!=="https://one-town-app.netlify.app"?a=this.WEB_BASE_URL:(console.warn("[ShareService] \u26A0\uFE0F Please configure WEB_BASE_URL in share.service.ts with your public domain."),a=e)),`${a}/#/customers/info?providerId=${t}`}shareToWhatsApp(t,e){let r=this.generateWebUrl(t),i=e?`Check out *${e}* on One Stage!

${r}`:`Check out this provider on One Stage!

${r}`,o=`https://wa.me/?text=${encodeURIComponent(i)}`;!!window.ReactNativeWebView||!!window.webkit?.messageHandlers?.reactNative?this.shareProvider(t,e):window.open(o,"_blank")}shareProvider(t,e){let r=this.generateDeepLink(t,e),i=this.generateWebUrl(t),o={title:e?`Check out ${e}`:"Check out this provider",text:e?`Check out ${e} on One Stage!`:"Check out this provider on One Stage!",url:r,providerId:t,providerName:e};if(!!window.ReactNativeWebView||!!window.webkit?.messageHandlers?.reactNative){let s=o.text;this.reactNativeCommunicator.passActionToRN({action:"SHARE",title:o.title,text:s,message:s,deepLink:r,webUrl:i,url:i,providerId:t,providerName:e,isLocalIP:/^(https?:\/\/)?(10\.|172\.(1[6-9]|2[0-9]|3[01])\.|192\.168\.)/.test(i)})}else navigator.share?navigator.share({title:o.title,text:o.text,url:i}).then(()=>{}).catch(s=>{console.error("Error sharing:",s),s.name!=="AbortError"&&this.shareToWhatsApp(t,e)}):this.shareToWhatsApp(t,e)}copyToClipboard(t){navigator.clipboard&&navigator.clipboard.writeText?navigator.clipboard.writeText(t).then(()=>{}).catch(e=>{console.error("Failed to copy to clipboard:",e),this.fallbackCopyToClipboard(t)}):this.fallbackCopyToClipboard(t)}fallbackCopyToClipboard(t){let e=document.createElement("textarea");e.value=t,e.style.position="fixed",e.style.left="-999999px",document.body.appendChild(e),e.focus(),e.select();try{document.execCommand("copy")}catch(r){console.error("Failed to copy to clipboard (fallback):",r)}document.body.removeChild(e)}handleDeepLink(t){try{if(t.startsWith(this.DEEP_LINK_SCHEME)){let e=t.replace(this.DEEP_LINK_SCHEME,""),[r,i]=e.split("?");if(r==="customers/info"&&i){let a=new URLSearchParams(i).get("providerId");a&&this.router.navigate(["/customers/info"],{state:{providerId:parseInt(a,10)}})}}else if(t.includes("#/customers/info")||t.includes("/customers/info"))try{let e=new URL(t),r;if(e.hash&&e.hash.includes("?")){let o=e.hash.split("?")[1];r=new URLSearchParams(o||"")}else r=e.searchParams;let i=r.get("providerId");i&&this.router.navigate(["/customers/info"],{queryParams:{providerId:i},state:{providerId:parseInt(i,10)}})}catch{let r=t.match(/#\/customers\/info\?providerId=(\d+)/);if(r&&r[1]){let i=r[1];this.router.navigate(["/customers/info"],{queryParams:{providerId:i},state:{providerId:parseInt(i,10)}})}}}catch(e){console.error("Error handling deep link:",e)}}static \u0275fac=function(e){return new(e||c)(n(p),n(d),n(h))};static \u0275prov=l({token:c,factory:c.\u0275fac,providedIn:"root"})};export{m as a};
